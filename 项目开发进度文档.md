# 个人博客系统开发进度文档

## 项目概述
- **项目名称**: 个人博客系统 (myBlog)
- **技术栈**: Spring Boot 3.2.0 + Java 17 + MyBatis-Plus + MySQL + Spring Security
- **开发者**: lanzhiqiang

---

## 第一阶段：✅ 项目初始化与配置修复 (已完成)

### 完成内容：
1. ✅ 修复 pom.xml 配置错误
   - 将 Spring Boot 版本从 3.2.1 改为 3.2.0（稳定版本）
   - 移除空的元数据标签（url, licenses, developers, scm）
2. ✅ 下载所有 Maven 依赖
3. ✅ 验证项目编译成功

### 依赖清单：
- Spring Boot Web Starter
- MyBatis-Plus Boot Starter (3.5.4)
- Spring Security
- Spring Validation
- MySQL Connector J
- Lombok
- JWT (JJWT 0.11.5)
- Test 相关依赖

---

## 第二阶段：数据库设计与连接配置

### 1. MySQL 数据库搭建指南

#### 本地 MySQL 安装要求：
- MySQL 版本：8.0 或以上
- 默认端口：3306
- 创建数据库：`myblog`
- 字符集：UTF8MB4

#### 数据库创建命令：
```sql
CREATE DATABASE IF NOT EXISTS myblog 
CHARACTER SET utf8mb4 
COLLATE utf8mb4_unicode_ci;
```

### 2. 数据表设计（共 4 张表）

#### 2.1 用户表 (user)
```sql
CREATE TABLE `user` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '用户ID',
  `username` VARCHAR(50) NOT NULL UNIQUE COMMENT '用户名（自定义ID）',
  `password` VARCHAR(255) NOT NULL COMMENT '密码（加密存储）',
  `nickname` VARCHAR(50) COMMENT '昵称',
  `email` VARCHAR(100) COMMENT '邮箱',
  `avatar` VARCHAR(255) COMMENT '头像URL',
  `role` VARCHAR(20) NOT NULL DEFAULT 'GUEST' COMMENT '角色：ADMIN/GUEST',
  `status` TINYINT DEFAULT 1 COMMENT '状态：1-正常 0-禁用',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_username` (`username`),
  KEY `idx_role` (`role`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表';
```

#### 2.2 博文表 (blog_post)
```sql
CREATE TABLE `blog_post` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '博文ID',
  `title` VARCHAR(200) NOT NULL COMMENT '标题',
  `content` TEXT NOT NULL COMMENT '内容',
  `summary` VARCHAR(500) COMMENT '摘要',
  `category` VARCHAR(20) NOT NULL COMMENT '分类：CTF/Learn/Something',
  `cover_image` VARCHAR(255) COMMENT '封面图片URL',
  `author_id` BIGINT NOT NULL COMMENT '作者ID（博主）',
  `view_count` INT DEFAULT 0 COMMENT '浏览量',
  `status` TINYINT DEFAULT 1 COMMENT '状态：1-发布 0-草稿',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_author` (`author_id`),
  KEY `idx_category` (`category`),
  KEY `idx_create_time` (`create_time`),
  KEY `idx_title` (`title`),
  FULLTEXT KEY `ft_title_content` (`title`, `content`) COMMENT '全文搜索索引',
  CONSTRAINT `fk_post_author` FOREIGN KEY (`author_id`) REFERENCES `user` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='博文表';
```

#### 2.3 评论表 (comment)
```sql
CREATE TABLE `comment` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '评论ID',
  `post_id` BIGINT NOT NULL COMMENT '博文ID',
  `user_id` BIGINT NOT NULL COMMENT '评论用户ID',
  `content` TEXT NOT NULL COMMENT '评论内容',
  `parent_id` BIGINT COMMENT '父评论ID（用于回复）',
  `reply_to_user_id` BIGINT COMMENT '回复给谁（用户ID）',
  `status` TINYINT DEFAULT 1 COMMENT '状态：1-正常 0-删除',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_post` (`post_id`),
  KEY `idx_user` (`user_id`),
  KEY `idx_parent` (`parent_id`),
  KEY `idx_create_time` (`create_time`),
  CONSTRAINT `fk_comment_post` FOREIGN KEY (`post_id`) REFERENCES `blog_post` (`id`),
  CONSTRAINT `fk_comment_user` FOREIGN KEY (`user_id`) REFERENCES `user` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='评论表';
```

#### 2.4 博文标签关联表 (可选扩展)
```sql
CREATE TABLE `tag` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '标签ID',
  `name` VARCHAR(50) NOT NULL UNIQUE COMMENT '标签名',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='标签表';

CREATE TABLE `post_tag` (
  `post_id` BIGINT NOT NULL COMMENT '博文ID',
  `tag_id` BIGINT NOT NULL COMMENT '标签ID',
  PRIMARY KEY (`post_id`, `tag_id`),
  CONSTRAINT `fk_pt_post` FOREIGN KEY (`post_id`) REFERENCES `blog_post` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_pt_tag` FOREIGN KEY (`tag_id`) REFERENCES `tag` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='博文标签关联表';
```

### 3. 项目连接 MySQL 配置

#### 3.1 修改 application.properties
```properties
# 应用名称
spring.application.name=myBlog

# 服务器端口
server.port=8080

# MySQL 数据库连接配置
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.url=jdbc:mysql://localhost:3306/myblog?useUnicode=true&characterEncoding=utf-8&useSSL=false&serverTimezone=Asia/Shanghai
spring.datasource.username=root
spring.datasource.password=你的MySQL密码

# HikariCP 连接池配置
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.connection-timeout=20000

# MyBatis-Plus 配置
mybatis-plus.mapper-locations=classpath*:/mapper/**/*.xml
mybatis-plus.type-aliases-package=com.lzq.myblog.entity
mybatis-plus.configuration.map-underscore-to-camel-case=true
mybatis-plus.configuration.log-impl=org.apache.ibatis.logging.stdout.StdOutImpl
mybatis-plus.global-config.db-config.id-type=auto
mybatis-plus.global-config.db-config.logic-delete-field=deleted
mybatis-plus.global-config.db-config.logic-delete-value=1
mybatis-plus.global-config.db-config.logic-not-delete-value=0

# JWT 配置
jwt.secret=your-256-bit-secret-key-change-this-in-production
jwt.expiration=86400000

# 日志配置
logging.level.com.lzq.myblog=DEBUG
logging.level.com.lzq.myblog.mapper=DEBUG
```

### 4. 需要创建/修改的文件清单

#### 实体类 (Entity)
- [x] `User.java` - 用户实体（已存在，需完善）
- [x] `BlogPost.java` - 博文实体（已存在，需完善）
- [x] `Comment.java` - 评论实体（已存在，需完善）
- [ ] `Tag.java` - 标签实体（新建）
- [ ] `PostTag.java` - 博文标签关联实体（新建）

#### Mapper 接口
- [ ] `UserMapper.java`
- [ ] `BlogPostMapper.java`
- [ ] `CommentMapper.java`
- [ ] `TagMapper.java`

#### Service 层
- [ ] `UserService.java` 及实现类
- [ ] `BlogPostService.java` 及实现类
- [ ] `CommentService.java` 及实现类
- [ ] `AuthService.java` - 认证服务（登录、注册）

#### Controller 层
- [ ] `AuthController.java` - 认证控制器（登录、注册）
- [ ] `UserController.java` - 用户管理（博主专用）
- [ ] `BlogPostController.java` - 博文管理
- [ ] `CommentController.java` - 评论管理
- [ ] `GuestController.java` - 游客操作

#### 安全配置
- [ ] `SecurityConfig.java` - Spring Security 配置
- [ ] `JwtAuthenticationFilter.java` - JWT 过滤器
- [ ] `JwtUtil.java` - JWT 工具类

#### DTO/VO 对象
- [ ] 登录请求/响应 DTO
- [ ] 注册请求 DTO
- [ ] 博文查询/创建/更新 DTO
- [ ] 评论创建/查询 DTO
- [ ] 统一响应对象 Result

---

## 第三阶段：核心功能实现（待开发）

### 博主功能：
1. [ ] 用户管理
   - 查看所有游客账号
   - 禁用/启用游客账号
   - 删除游客账号

2. [ ] 博文管理
   - 发布博文（含分类选择：CTF/Learn/Something）
   - 修改博文
   - 删除博文
   - 博文草稿功能

3. [ ] 评论管理
   - 查看所有评论
   - 回复评论
   - 删除评论

### 游客功能：
1. [ ] 用户认证
   - 注册账号（username + password）
   - 登录系统（JWT Token）

2. [ ] 博文功能
   - 搜索博文（标题/内容全文搜索）
   - 按分类查看博文
   - 查看博文详情
   - 浏览量统计

3. [ ] 评论功能
   - 发表评论
   - 回复评论
   - 查看自己的评论

---

## 第四阶段：测试与优化（待开发）

1. [ ] 单元测试
2. [ ] 接口测试
3. [ ] 性能优化
4. [ ] 安全加固

---

## 功能扩展建议（可选）

### 已在设计中的扩展：
1. [ ] 标签系统 - 博文可以打多个标签
2. [ ] 点赞功能 - 博文和评论点赞
3. [ ] 收藏功能 - 用户收藏博文
4. [ ] 博文浏览历史
5. [ ] 热门博文推荐
6. [ ] Markdown 编辑器支持
7. [ ] 图片上传功能
8. [ ] 评论审核机制
9. [ ] 邮箱验证注册
10. [ ] 找回密码功能

### 高级扩展：
1. [ ] Redis 缓存（热门博文、浏览量）
2. [ ] Elasticsearch 全文搜索
3. [ ] 消息通知系统
4. [ ] 数据统计Dashboard
5. [ ] RESTful API 文档（Swagger/Knife4j）
6. [ ] 前端页面（Vue/React）

---

## 数据库总结

### 核心表（4张）：
1. **user** - 用户表（游客+博主）
2. **blog_post** - 博文表
3. **comment** - 评论表
4. **tag** + **post_tag** - 标签及关联表（扩展）

### 设计亮点：
- 使用外键约束保证数据一致性
- 全文索引支持博文搜索
- 软删除机制（status字段）
- 评论支持多级回复（parent_id）
- 分类固定为：CTF、Learn、Something

---

## 下一步行动

### 待确认：
1. MySQL 数据库密码
2. 是否需要标签系统
3. 是否需要其他扩展功能
4. 前端开发计划

### 待执行（等待确认后）：
1. 创建数据库和数据表
2. 完善实体类
3. 创建 Mapper 接口
4. 实现 Service 业务逻辑
5. 开发 Controller 接口
6. 配置 Spring Security + JWT
7. 测试所有功能

---

**文档版本**: v1.0  
**创建时间**: 2025-12-01  
**最后更新**: 2025-12-01

