# MyBlog 技术文档

## 项目概述

| 项目 | 说明 |
|------|------|
| 名称 | 个人博客系统 (MyBlog) |
| 技术栈 | Spring Boot 3.2 + Vue 3 + MySQL |
| 开发者 | lanzhiqiang |
| 状态 | ✅ 开发完成 |

---

## 一、快速启动

### 环境要求
- Java 17+
- MySQL 8.0+
- Node.js 18+
- Maven 3.6+

### 启动步骤

```bash
# 1. 初始化数据库
mysql -u root -p < src/main/resources/sql/init.sql

# 2. 启动后端 (端口 8080)
./mvnw spring-boot:run

# 3. 启动前端 (端口 5173)
cd frontend && npm run dev
```

### 访问地址

| 服务 | 地址 |
|------|------|
| 前端页面 | http://localhost:5173 |
| 后端 API | http://localhost:8080 |
| API 文档 | http://localhost:8080/doc.html |
| 管理员账号 | sh4d0w / 467194403 |

---

## 二、技术架构

### 后端依赖

| 依赖 | 版本 | 说明 |
|------|------|------|
| Spring Boot | 3.2.0 | Web + Security + Validation |
| MyBatis-Plus | 3.5.5 | ORM 框架 |
| MySQL Connector | 8.x | 数据库驱动 |
| JJWT | 0.11.5 | JWT 认证 |
| Knife4j | 4.3.0 | API 文档 |
| CommonMark | 0.21.0 | Markdown 解析 |
| Lombok | - | 代码简化 |

### 前端依赖

| 依赖 | 说明 |
|------|------|
| Vue 3 + Vite | 前端框架 |
| Element Plus | UI 组件库 |
| Vue Router 4 | 路由管理 |
| Pinia | 状态管理 |
| Axios | HTTP 请求 |
| highlight.js | 代码高亮 |

---

## 三、数据库设计（4张表）

### 用户表 (user)

| 字段 | 类型 | 说明 |
|------|------|------|
| id | BIGINT | 主键，自增 |
| username | VARCHAR(50) | 用户名（唯一） |
| password | VARCHAR(255) | BCrypt 加密密码 |
| nickname | VARCHAR(50) | 昵称 |
| email | VARCHAR(100) | 邮箱 |
| avatar | VARCHAR(255) | 头像 URL |
| role | VARCHAR(20) | 角色: ADMIN / GUEST |
| status | TINYINT | 1-正常 / 0-禁用 |
| create_time | DATETIME | 创建时间 |
| update_time | DATETIME | 更新时间 |

### 博文表 (blog_post)

| 字段 | 类型 | 说明 |
|------|------|------|
| id | BIGINT | 主键，自增 |
| title | VARCHAR(200) | 标题 |
| content | LONGTEXT | 内容（Markdown） |
| summary | VARCHAR(500) | 摘要 |
| category | VARCHAR(20) | 分类: CTF / LEARN / SOMETHING |
| cover_image | VARCHAR(255) | 封面图 URL |
| author_id | BIGINT | 作者 ID（外键 → user.id） |
| view_count | INT | 浏览量 |
| status | TINYINT | 1-发布 / 0-草稿 |
| create_time | DATETIME | 创建时间 |
| update_time | DATETIME | 更新时间 |

### 评论表 (comment)

| 字段 | 类型 | 说明 |
|------|------|------|
| id | BIGINT | 主键，自增 |
| post_id | BIGINT | 博文 ID（外键 → blog_post.id） |
| user_id | BIGINT | 用户 ID（外键 → user.id） |
| content | TEXT | 评论内容 |
| parent_id | BIGINT | 父评论 ID（回复功能） |
| reply_to_user_id | BIGINT | 回复目标用户 ID |
| status | TINYINT | 1-正常 / 0-隐藏 |
| create_time | DATETIME | 创建时间 |
| update_time | DATETIME | 更新时间 |

### 点赞表 (post_like)

| 字段 | 类型 | 说明 |
|------|------|------|
| id | BIGINT | 主键，自增 |
| post_id | BIGINT | 博文 ID（外键 → blog_post.id） |
| user_id | BIGINT | 用户 ID（外键 → user.id） |
| create_time | DATETIME | 创建时间 |

---

## 四、API 接口

### 公开接口

| 方法 | 路径 | 说明 |
|------|------|------|
| POST | `/api/auth/login` | 用户登录 |
| POST | `/api/auth/register` | 游客注册 |
| POST | `/api/markdown/render` | Markdown 渲染为 HTML |
| POST | `/api/markdown/summary` | 提取 Markdown 摘要 |
| GET | `/api/posts` | 博文列表 |
| GET | `/api/posts/{id}` | 博文详情 |
| GET | `/api/posts/category/{category}` | 按分类查询 |
| GET | `/api/posts/search` | 搜索博文 |
| GET | `/api/comments/post/{postId}` | 获取评论 |
| GET | `/api/comments/{commentId}/replies` | 获取评论的回复 |
| GET | `/api/categories` | 获取分类列表 |
| GET | `/api/categories/{id}` | 获取分类详情 |

### 认证接口（需要 Token）

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | `/api/auth/me` | 获取当前用户信息 |
| PUT | `/api/auth/profile` | 更新昵称、头像 |
| PUT | `/api/auth/password` | 修改密码 |
| POST | `/api/comments` | 发表评论 |
| DELETE | `/api/comments/{id}` | 删除自己的评论 |
| POST | `/api/interaction/like/{postId}` | 点赞 |
| DELETE | `/api/interaction/like/{postId}` | 取消点赞 |
| GET | `/api/interaction/status/{postId}` | 获取互动状态 |
| POST | `/api/upload/image` | 上传图片 |
| POST | `/api/upload/avatar` | 上传头像 |
| POST | `/api/upload/cover` | 上传封面图 |

### 管理员接口（需要 ADMIN 角色）

| 方法 | 路径 | 说明 |
|------|------|------|
| POST | `/api/posts` | 创建博文 |
| PUT | `/api/posts` | 更新博文 |
| DELETE | `/api/posts/{id}` | 删除博文 |
| GET | `/api/admin/users` | 用户列表 |
| PUT | `/api/admin/users/{id}/status` | 启用/禁用用户 |
| DELETE | `/api/admin/users/{id}` | 删除用户 |
| GET | `/api/admin/comments` | 评论列表（分页） |
| PUT | `/api/admin/comments/{id}/status` | 审核评论（显示/隐藏） |
| DELETE | `/api/admin/comments/{id}` | 删除评论 |
| GET | `/api/admin/stats` | 仪表盘统计数据 |

---

## 五、项目结构

### 后端结构

```
src/main/java/com/lzq/myblog/
├── MyBlogApplication.java      # 启动类
├── common/Result.java          # 统一响应
├── config/
│   ├── SecurityConfig.java     # 安全配置
│   ├── Knife4jConfig.java      # API 文档
│   └── MyBatisPlusConfig.java  # ORM 配置
├── controller/
│   ├── AuthController.java     # 认证
│   ├── PostController.java     # 博文
│   ├── CommentController.java  # 评论
│   ├── InteractionController.java  # 点赞/收藏
│   ├── CategoryController.java # 分类
│   ├── MarkdownController.java # Markdown 渲染
│   ├── AdminController.java    # 管理员
│   └── UploadController.java   # 文件上传
├── entity/                     # 实体类
├── dto/                        # 数据传输对象
├── mapper/                     # 数据访问层
├── service/                    # 业务逻辑层
├── filter/JwtAuthenticationFilter.java
└── utils/JwtUtils.java
```

### 前端结构

```
frontend/src/
├── api/                # API 接口
│   ├── auth.js         # 认证
│   ├── post.js         # 博文
│   ├── comment.js      # 评论
│   ├── interaction.js  # 互动
│   └── admin.js        # 管理
├── views/
│   ├── guest/          # 前台页面
│   │   ├── Home.vue
│   │   ├── PostList.vue
│   │   └── PostDetail.vue
│   ├── admin/          # 管理后台
│   │   ├── Dashboard.vue
│   │   ├── Posts.vue
│   │   └── Comments.vue
│   └── auth/           # 认证页面
│       ├── Login.vue
│       └── Register.vue
├── store/user.js       # 用户状态
└── router/index.js     # 路由配置
```

---

## 六、配置说明

```properties
# 服务端口
server.port=8080

# 数据库配置
spring.datasource.url=jdbc:mysql://localhost:3306/myblog
spring.datasource.username=root
spring.datasource.password=

# JWT 配置
jwt.secret=myBlogSecretKey2025SH4D0W467194403
jwt.expiration=86400000

# 文件上传
file.upload.path=./uploads
file.upload.max-size=10485760
```

---

## 七、功能清单

| 功能模块 | 说明 |
|----------|------|
| 用户认证 | 登录、注册、JWT Token |
| 博文管理 | 增删改查、分类、搜索 |
| Markdown | 编辑器、渲染、代码高亮 |
| 评论系统 | 发表、回复、审核 |
| 点赞功能 | 登录用户可点赞/取消 |
| 图片上传 | 支持本地图片路径自动处理 |
| 管理后台 | 仪表盘、用户管理、评论管理 |
| API 文档 | Knife4j 自动生成 |
